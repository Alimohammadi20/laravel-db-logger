const faLang = {
    "emptyTable": "هیچ داده‌ای در جدول وجود ندارد",
    "info": "نمایش _START_ تا _END_ از _TOTAL_ ردیف",
    "infoEmpty": "نمایش 0 تا 0 از 0 ردیف",
    "infoFiltered": "(فیلتر شده از _MAX_ ردیف)",
    "infoThousands": ",",
    "lengthMenu": "نمایش _MENU_ ردیف",
    "processing": "در حال پردازش...",
    "search": "جستجو:",
    "zeroRecords": "رکوردی با این مشخصات پیدا نشد",
    "paginate": {
        "next": "بعدی",
        "previous": "قبلی",
        "first": "ابتدا",
        "last": "انتها"
    },
    "aria": {
        "sortAscending": ": فعال سازی نمایش به صورت صعودی",
        "sortDescending": ": فعال سازی نمایش به صورت نزولی"
    },
    "autoFill": {
        "cancel": "انصراف",
        "fill": "پر کردن همه سلول ها با ساختار سیستم",
        "fillHorizontal": "پر کردن سلول به صورت افقی",
        "fillVertical": "پرکردن سلول به صورت عمودی"
    },
    "buttons": {
        "collection": "مجموعه",
        "colvis": "قابلیت نمایش ستون",
        "colvisRestore": "بازنشانی قابلیت نمایش",
        "copy": "کپی",
        "copySuccess": {
            "1": "یک ردیف داخل حافظه کپی شد",
            "_": "%ds ردیف داخل حافظه کپی شد"
        },
        "copyTitle": "کپی در حافظه",
        "pageLength": {
            "-1": "نمایش همه ردیف‌ها",
            "_": "نمایش %d ردیف",
            "1": "نمایش 1 ردیف"
        },
        "print": "چاپ",
        "copyKeys": "برای کپی داده جدول در حافظه سیستم کلید های ctrl یا ⌘ + C را فشار دهید",
        "csv": "فایل CSV",
        "pdf": "فایل PDF",
        "renameState": "تغییر نام",
        "updateState": "به روز رسانی",
        "excel": "فایل اکسل",
        "createState": "ایجاد وضعیت جدول",
        "removeAllStates": "حذف همه وضعیت ها",
        "removeState": "حذف",
        "savedStates": "وضعیت های ذخیره شده",
        "stateRestore": "بازگشت به وضعیت %d"
    },
    "searchBuilder": {
        "add": "افزودن شرط",
        "button": {
            "0": "جستجو ساز",
            "_": "جستجوساز (%d)"
        },
        "clearAll": "خالی کردن همه",
        "condition": "شرط",
        "conditions": {
            "date": {
                "after": "بعد از",
                "before": "بعد از",
                "between": "میان",
                "empty": "خالی",
                "not": "نباشد",
                "notBetween": "میان نباشد",
                "notEmpty": "خالی نباشد",
                "equals": "برابر باشد با"
            },
            "number": {
                "between": "میان",
                "empty": "خالی",
                "gt": "بزرگتر از",
                "gte": "برابر یا بزرگتر از",
                "lt": "کمتر از",
                "lte": "برابر یا کمتر از",
                "not": "نباشد",
                "notBetween": "میان نباشد",
                "notEmpty": "خالی نباشد",
                "equals": "برابر باشد با"
            },
            "string": {
                "contains": "حاوی",
                "empty": "خالی",
                "endsWith": "به پایان می رسد با",
                "not": "نباشد",
                "notEmpty": "خالی نباشد",
                "startsWith": "شروع  شود با",
                "notContains": "نباشد حاوی",
                "notEndsWith": "پایان نیابد با",
                "notStartsWith": "شروع نشود با",
                "equals": "برابر باشد با"
            },
            "array": {
                "empty": "خالی",
                "contains": "حاوی",
                "not": "نباشد",
                "notEmpty": "خالی نباشد",
                "without": "بدون",
                "equals": "برابر باشد با"
            }
        },
        "data": "اطلاعات",
        "logicAnd": "و",
        "logicOr": "یا",
        "title": {
            "0": "جستجو ساز",
            "_": "جستجوساز (%d)"
        },
        "value": "مقدار",
        "deleteTitle": "حذف شرط فیلتر",
        "leftTitle": "شرط بیرونی",
        "rightTitle": "شرط فرورفتگی"
    },
    "select": {
        "cells": {
            "1": "1 سلول انتخاب شد",
            "_": "%d سلول انتخاب شد"
        },
        "columns": {
            "1": "یک ستون انتخاب شد",
            "_": "%d ستون انتخاب شد"
        },
        "rows": {
            "1": "1ردیف انتخاب شد",
            "_": "%d  انتخاب شد"
        }
    },
    "thousands": ",",
    "searchPanes": {
        "clearMessage": "همه را پاک کن",
        "collapse": {
            "0": "صفحه جستجو",
            "_": "صفحه جستجو (٪ d)"
        },
        "count": "{total}",
        "countFiltered": "{shown} ({total})",
        "emptyPanes": "صفحه جستجو وجود ندارد",
        "loadMessage": "در حال بارگیری صفحات جستجو ...",
        "title": "فیلترهای فعال - %d",
        "showMessage": "نمایش همه",
        "collapseMessage": "بستن همه"
    },
    "loadingRecords": "در حال بارگذاری...",
    "datetime": {
        "previous": "قبلی",
        "next": "بعدی",
        "hours": "ساعت",
        "minutes": "دقیقه",
        "seconds": "ثانیه",
        "amPm": [
            "صبح",
            "عصر"
        ],
        "months": {
            "0": "ژانویه",
            "1": "فوریه",
            "10": "نوامبر",
            "4": "می",
            "8": "سپتامبر",
            "11": "دسامبر",
            "3": "آوریل",
            "9": "اکتبر",
            "7": "اوت",
            "2": "مارس",
            "5": "ژوئن",
            "6": "ژوئیه"
        },
        "unknown": "-",
        "weekdays": [
            "یکشنبه",
            "دوشنبه",
            "سه‌شنبه",
            "چهارشنبه",
            "پنجشنبه",
            "جمعه",
            "شنبه"
        ]
    },
    "editor": {
        "close": "بستن",
        "create": {
            "button": "جدید",
            "title": "ثبت جدید",
            "submit": "ایجــاد"
        },
        "edit": {
            "button": "ویرایش",
            "title": "ویرایش",
            "submit": "به روز رسانی"
        },
        "remove": {
            "button": "حذف",
            "title": "حذف",
            "submit": "حذف",
            "confirm": {
                "_": "آیا از حذف %d خط اطمینان دارید؟",
                "1": "آیا از حذف یک خط اطمینان دارید؟"
            }
        },
        "multi": {
            "restore": "واگرد",
            "noMulti": "این ورودی را می توان به صورت جداگانه ویرایش کرد، اما نه بخشی از یک گروه",
            "title": "مقادیر متعدد",
            "info": "مقادیر متعدد"
        },
        "error": {
            "system": "خطایی رخ داده (اطلاعات بیشتر)"
        }
    },
    "decimal": ".",
    "stateRestore": {
        "creationModal": {
            "button": "ایجاد",
            "columns": {
                "search": "جستجوی ستون",
                "visible": "وضعیت نمایش ستون"
            },
            "name": "نام:",
            "order": "مرتب سازی",
            "paging": "صفحه بندی",
            "search": "جستجو",
            "select": "انتخاب",
            "title": "ایجاد وضعیت جدید",
            "toggleLabel": "شامل:",
            "scroller": "موقعیت جدول (اسکرول)",
            "searchBuilder": "صفحه جستجو"
        },
        "emptyError": "نام نمیتواند خالی باشد.",
        "removeConfirm": "آیا از حذف %s مطمئنید؟",
        "removeJoiner": "و",
        "renameButton": "تغییر نام",
        "renameLabel": "نام جدید برای $s :",
        "duplicateError": "وضعیتی با این نام از پیش ذخیره شده.",
        "emptyStates": "هیچ وضعیتی ذخیره نشده",
        "removeError": "حذف با خطا موماجه شد",
        "removeSubmit": "حذف وضعیت",
        "removeTitle": "حذف وضعیت جدول",
        "renameTitle": "تغییر نام وضعیت"
    }
};
$(document).ready(function () {
    $('#filter-process option:eq(0)').attr('selected', 'selected');

    function initDatatable() {
        $('#inbox-table').DataTable({
            language: faLang,
            pageLength: 10,
            columnDefs: [{
                "targets": [0, 1, 2],
                "orderable": false
            }],
        });
    }

    function IsValidJson(text) {
        if (typeof text !== "string") {
            return false;
        }
        try {
            JSON.parse(text);
            return true;
        } catch (error) {
            return false;
        }
    }

    function prepareData(input) {
        try {
            input = (input !== null && input !== '') ? JSON.parse(input) : input;
            for (const key in input) {
                for (const innerKey in input[key]) {
                    let index = 0;
                    if (typeof input[key][innerKey] == 'object') {
                        if (Array.isArray(input[key][innerKey])) {
                            for (const innerKey2 of input[key][innerKey]) {
                                for (const itemKey in innerKey2) {
                                    input[key][innerKey][parseInt(index)][itemKey] = IsValidJson(input[key][innerKey][parseInt(index)][itemKey]) ? JSON.parse(input[key][innerKey][parseInt(index)][itemKey]) : input[key][innerKey][parseInt(index)][itemKey];
                                }
                                index++;
                            }
                        } else {
                            if (typeof input[key][innerKey] == 'object') {
                                for (const innerKeyKey in input[key][innerKey]) {
                                    input[key][innerKey][innerKeyKey] = IsValidJson(input[key][innerKey][innerKeyKey]) ? JSON.parse(input[key][innerKey][innerKeyKey]) : input[key][innerKey][innerKeyKey];
                                }
                            } else {
                                for (const innerKey2 of input[key][innerKey]) {
                                    for (const itemKey in innerKey2) {
                                        input[key][innerKey][parseInt(index)][itemKey] = IsValidJson(input[key][innerKey][parseInt(index)][itemKey]) ? JSON.parse(input[key][innerKey][parseInt(index)][itemKey]) : input[key][innerKey][parseInt(index)][itemKey];
                                    }
                                }
                                index++;
                            }
                        }
                    }
                    input[key][innerKey] = IsValidJson(input[key][innerKey]) ? JSON.parse(input[key][innerKey]) : input[key][innerKey];
                }
            }
        } catch (e) {}
        return input;
    }
    $('#reset-btn').on('click', function (e) {
        $('#input-search').val('')
        $('#input-date').val('')
        $("#input-type").prop("selectedIndex", 0).val();
        $("#input-level").prop("selectedIndex", 0).val();
        $("#submit-btn").click();
    })
    $('.show-input').on('click', function () {
        let url = $(this).data('url')
        $.ajax({
            type: 'get',
            async: false,
            url: url,
            beforeSend: function () {
                $('#json_input').html('');
                $('#json_output').html('');
                $('#json_context').html('');
                $('#json_detail').html('');
            },
            success: function (response) {
                response = response.data;
                response.output = prepareData(response.output)
                response.input = prepareData(response.input)
                response.context = prepareData(response.context)
                response.extra_data = prepareData(response.extra_data)
                if (response.output === null) {
                    response.output = {};
                }
                response.output.message = prepareData(response.message);
                if (response.input=== null){
                    $('#input-tab').hide();
                }else{
                    $('#input-tab').show();
                    $('#json_input').html(prettyPrintJson.toHtml(response.input));
                }
                if (response.output=== null){
                    $('#output-tab').hide();
                }else{
                    $('#output-tab').show();
                    $('#json_output').html(prettyPrintJson.toHtml(response.output));
                }
                if (response.context=== null){
                    $('#context-tab').hide();
                }else{
                    $('#context-tab').show();
                    $('#json_context').html(prettyPrintJson.toHtml(response.context));
                }
                if (response.extra_data=== null){
                    $('#extradata-tab').hide();
                }else{
                    $('#extradata-tab').show();
                    $('#json_extradata').html(prettyPrintJson.toHtml(response.extra_data));
                }
                delete response.input;
                delete response.output;
                delete response.context;
                delete response.extra_data;
                delete response.message;
                $('#json_detail').html(prettyPrintJson.toHtml(response));
            }
        })
    });
    $('.delete-logs').on('click', function (e) {
        e.preventDefault();
        let url = $(this).attr('href');
        let reference = $(this).data('reference');
        Swal.fire({
            title: 'آیا مطمئن هسنید؟',
            icon: 'info',
            showCancelButton: true,
            confirmButtonText: 'بله',
            cancelButtonText: 'خیر'
        }).then((result) => {
            if (result.value === true) {
                $.ajax({
                    type: 'get', url: url
                }).then(result => {
                    if (result.status) {
                        $('#'+reference).fadeOut();
                    } else {
                        Swal.fire({
                            title: 'کاربرگرامی',
                            icon: 'warning',
                            text: 'در انجام این عملیات خطایی رخ داده است'
                        })
                    }
                })
            }
        }, function () {
            return false;
        })
    })

    initDatatable()
});
